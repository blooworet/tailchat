/**
 * AudioRecorderæ ·å¼ - åŸºäºTelegram TTçš„å¸ƒå±€ç­–ç•¥
 * é˜²æ­¢å½•åˆ¶æ—¶å®¹å™¨æ— é™æ‹‰é•¿
 */

/* å½•åˆ¶çŠ¶æ€å®¹å™¨ - ç±»ä¼¼Telegramçš„recording-state */
.recording-state-container {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  height: ~"var(--base-height, 3rem)";
  min-width: 0; /* é˜²æ­¢flexå­é¡¹æº¢å‡º */
  max-width: 100%; /* é˜²æ­¢æº¢å‡ºçˆ¶å®¹å™¨ */
  flex: 1;
  position: relative;
  padding: 0 0.5rem;
  overflow: hidden; /* é˜²æ­¢å†…å®¹æº¢å‡º */
  
  /* ğŸ¯ çŠ¶æ€åˆ‡æ¢è¿›å…¥åŠ¨ç”» */
  animation: slide-in-recording 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  transform-origin: center;
}

/* çŠ¶æ€åˆ‡æ¢åŠ¨ç”» - å½•éŸ³æ¨¡å¼è¿›å…¥ */
@keyframes slide-in-recording {
  0% {
    opacity: 0;
    transform: translateX(-20px) scale(0.95);
  }
  100% {
    opacity: 1;
    transform: translateX(0) scale(1);
  }
}

/* çŠ¶æ€åˆ‡æ¢åŠ¨ç”» - å½•éŸ³æ¨¡å¼é€€å‡º */
@keyframes slide-out-recording {
  0% {
    opacity: 1;
    transform: translateX(0) scale(1);
  }
  100% {
    opacity: 0;
    transform: translateX(20px) scale(0.95);
  }
}

/* å½•éŸ³æŒ‰é’®è„‰å†²åŠ¨ç”» */
@keyframes recording-pulse {
  0%, 100% {
    transform: scale(1);
    box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.3);
  }
  50% {
    transform: scale(1.05);
    box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2);
  }
}

/* å½•éŸ³çŠ¶æ€é€€å‡ºåŠ¨ç”»ç±» */
.recording-state-container.exiting {
  animation: slide-out-recording 0.25s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

/* å½•åˆ¶çŠ¶æ€æ—¶é—´æ˜¾ç¤º - é‡‡ç”¨Telegramæ ·å¼ */
.recording-state {
  position: relative;
  display: inline-block;
  flex-shrink: 0; /* é˜²æ­¢è¢«å‹ç¼© */
  
  min-width: 3.5rem; /* ä¿è¯æ—¶é—´æ˜¾ç¤ºçš„æœ€å°å®½åº¦ */
  height: ~"var(--base-height, 3rem)";
  padding: 0 1rem 0 0.75rem;
  
  font-family: ~"var(--font-family-mono, 'SF Pro Display', system-ui)";
  font-variant-numeric: tabular-nums; /* æ•°å­—ç­‰å®½ */
  font-weight: 500;
  font-size: 0.875rem;
  line-height: ~"var(--base-height, 3rem)";
  color: ~"var(--color-text-secondary)";
  
  /* å½•åˆ¶æŒ‡ç¤ºçº¢ç‚¹ */
  &::after {
    content: "";
    position: absolute;
    top: 50%;
    right: 0.25rem;
    
    width: 0.5rem;
    height: 0.5rem;
    margin-top: -0.25rem;
    border-radius: 0.25rem;
    
    background: ~"var(--color-error, #ff3b30)";
    animation: recording-pulse 1.5s infinite ease-in-out;
  }
}

/* æ³¢å½¢å¯è§†åŒ–åŒºåŸŸ */
.recording-waveform {
  flex: 1;
  min-width: 0; /* é˜²æ­¢æº¢å‡º */
  max-width: 12rem; /* é™åˆ¶æœ€å¤§å®½åº¦ */
  display: flex;
  align-items: center;
  justify-content: center;
  height: 2rem;
  
  .waveform-canvas {
    width: 100%;
    height: 100%;
    border-radius: 0.25rem;
    background: transparent;
  }
}

/* æ“ä½œæŒ‰é’®åŒºåŸŸ */
.recording-actions {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex-shrink: 0; /* é˜²æ­¢è¢«å‹ç¼© */
  
  .action-button {
    font-size: 1.5rem;
    cursor: pointer;
    transition: all 0.15s ease;
    border-radius: 50%;
    padding: 0.25rem;
    
    &:hover {
      transform: scale(1.1);
    }
    
    &:active {
      transform: scale(0.95);
    }
    
    &.cancel-button {
      color: ~"var(--color-error, #ff3b30)";
      
      &:hover {
        color: ~"var(--color-error-hover, #d70015)";
        background: rgba(255, 59, 48, 0.1);
      }
    }
    
    &.send-button {
      color: ~"var(--color-primary, #3390ec)";
      
      &:hover {
        color: ~"var(--color-primary-hover, #2679d5)";
        background: rgba(51, 144, 236, 0.1);
      }
    }
  }
}

/* å½•åˆ¶è„‰å†²åŠ¨ç”» - ä»¿macOSé£æ ¼ */
@keyframes recording-pulse {
  0%, 100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.3;
    transform: scale(0.8);
  }
}

/* å½•éŸ³æŒ‰é’®æ ·å¼ */
.audio-recorder-button {
  font-size: 1.5rem;
  cursor: pointer;
  transition: all 0.15s ease;
  border-radius: 50%;
  padding: 0.25rem;
  
  &:hover {
    transform: scale(1.1);
    background: rgba(51, 144, 236, 0.1);
  }
  
  &:active {
    transform: scale(0.95);
  }
}

/* ğŸ¯ æŒ‰é’®ç»„çŠ¶æ€åˆ‡æ¢åŠ¨ç”» */
.input-button-group {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  
  /* æŒ‰é’®æ˜¾ç¤ºåŠ¨ç”» */
  &.entering {
    animation: buttons-fade-in 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }
  
  /* æŒ‰é’®éšè—åŠ¨ç”» */
  &.exiting {
    animation: buttons-fade-out 0.25s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }
  
  /* å½•éŸ³çŠ¶æ€ä¸‹éšè— */
  &.recording-hidden {
    animation: buttons-slide-out 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }

  /* å½•éŸ³æ¨¡å¼ - åªæ˜¾ç¤ºå½•éŸ³æŒ‰é’® */
  &.recording-mode {
    /* éšè—éå½•éŸ³æŒ‰é’® */
    .chat-input-emotion,
    .chat-input-addon {
      display: none;
    }
    
    /* å½•éŸ³æŒ‰é’®ä¿æŒå¯è§ */
    .audio-recorder-button {
      display: block;
      
      &.recording {
        background-color: #ef4444 !important;
        color: white !important;
        box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.3);
        animation: recording-pulse 1.5s ease-in-out infinite;
      }
    }
  }
  
  /* ğŸµ Telegram é£æ ¼ç´§å‡‘å½•éŸ³çŠ¶æ€åŒ…è£…å™¨ */
  .recording-state-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 40px; /* ğŸ”§ å›ºå®šé«˜åº¦ï¼Œä¸å†è‡ªé€‚åº” */
    min-height: 40px;
    max-height: 40px; /* ğŸ”§ é™åˆ¶æœ€å¤§é«˜åº¦ï¼Œé˜²æ­¢æ’‘å¼€ */
    padding: 0;
    margin: 0;
    overflow: hidden; /* ğŸ”§ é˜²æ­¢å†…å®¹æº¢å‡º */
  }
  
  /* ä»å½•éŸ³çŠ¶æ€æ¢å¤ */
  &.recording-show {
    animation: buttons-slide-in 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }
}

/* æŒ‰é’®æ·¡å…¥åŠ¨ç”» */
@keyframes buttons-fade-in {
  0% {
    opacity: 0;
    transform: translateY(5px) scale(0.9);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* æŒ‰é’®æ·¡å‡ºåŠ¨ç”» */
@keyframes buttons-fade-out {
  0% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
  100% {
    opacity: 0;
    transform: translateY(-5px) scale(0.9);
  }
}

/* æŒ‰é’®æ¨ªå‘æ»‘å‡ºåŠ¨ç”»ï¼ˆå½•éŸ³æ—¶ï¼‰ */
@keyframes buttons-slide-out {
  0% {
    opacity: 1;
    transform: translateX(0) scale(1);
  }
  100% {
    opacity: 0;
    transform: translateX(30px) scale(0.8);
  }
}

/* æŒ‰é’®æ¨ªå‘æ»‘å…¥åŠ¨ç”»ï¼ˆå½•éŸ³ç»“æŸï¼‰ */
@keyframes buttons-slide-in {
  0% {
    opacity: 0;
    transform: translateX(30px) scale(0.8);
  }
  100% {
    opacity: 1;
    transform: translateX(0) scale(1);
  }
}

/* ä¸Šä¼ ç›¸å…³æ ·å¼å·²ç§»é™¤ */

/* ğŸ¯ å“åº”å¼è®¾è®¡ - å¢å¼ºç§»åŠ¨ç«¯çŠ¶æ€åˆ‡æ¢ */
@media (max-width: 600px) {
  .recording-container {
    gap: 0.5rem;
  }
  
  .recording-state {
    min-width: 3rem;
    padding: 0 0.75rem 0 0.5rem;
    font-size: 0.8125rem;
  }
  
  .recording-waveform {
    max-width: 8rem;
  }
  
  .recording-actions {
    gap: 0.25rem;
    
    .action-button {
      font-size: 1.375rem;
      /* ç§»åŠ¨ç«¯å¢å¼ºè§¦æ‘¸åé¦ˆ */
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      
      &:active {
        transform: scale(0.9);
        transition: transform 0.1s ease;
      }
    }
  }

  /* ğŸ¯ ç§»åŠ¨ç«¯çŠ¶æ€åˆ‡æ¢åŠ¨ç”»ä¼˜åŒ– */
  .recording-state-container {
    /* ç§»åŠ¨ç«¯æ›´å¿«çš„åŠ¨ç”» */
    animation-duration: 0.25s;
  }
  
  .input-button-group {
    /* ç§»åŠ¨ç«¯ç¼©çŸ­åŠ¨ç”»æ—¶é—´ */
    &.entering, &.exiting, &.recording-hidden, &.recording-show {
      animation-duration: 0.2s;
    }
  }
  
  /* ç§»åŠ¨ç«¯é”®ç›˜å¼¹å‡ºé€‚é… */
  .keyboard-showing & {
    .recording-state-container {
      padding: 0 0.25rem;
    }
    
    .input-button-group {
      gap: 0.125rem;
    }
  }
}

/* æš—è‰²ä¸»é¢˜é€‚é… */
@media (prefers-color-scheme: dark) {
  .recording-state {
    color: ~"var(--color-text-secondary-dark, rgba(255, 255, 255, 0.6))";
  }
  
  .recording-actions {
    .action-button {
      &.cancel-button:hover {
        background: rgba(255, 59, 48, 0.2);
      }
      
      &.send-button:hover {
        background: rgba(51, 144, 236, 0.2);
      }
    }
  }
}

/* ä¸»é¢˜å˜é‡å®šä¹‰ */
:root {
  --base-height: 3rem;
  --color-error: #ff3b30;
  --color-error-hover: #d70015;
  --color-primary: #3390ec;
  --color-primary-hover: #2679d5;
  --color-text-secondary: rgba(0, 0, 0, 0.6);
  --color-text-secondary-dark: rgba(255, 255, 255, 0.6);
  --font-family-mono: 'SF Pro Display', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
}

/* ğŸ¯ æ‰©å±•ç»„ä»¶çŠ¶æ€åˆ‡æ¢åŠ¨ç”» */
.command-list-container {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  
  &.entering {
    animation: command-list-slide-up 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }
  
  &.exiting {
    animation: command-list-slide-down 0.25s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }
}

/* å‘½ä»¤åˆ—è¡¨æ»‘å…¥åŠ¨ç”» */
@keyframes command-list-slide-up {
  0% {
    opacity: 0;
    transform: translateY(10px) scale(0.95);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* å‘½ä»¤åˆ—è¡¨æ»‘å‡ºåŠ¨ç”» */
@keyframes command-list-slide-down {
  0% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
  100% {
    opacity: 0;
    transform: translateY(10px) scale(0.95);
  }
}

/* è¡¨æƒ…é€‰æ‹©å™¨å’Œé™„ä»¶èœå•åŠ¨ç”» */
.emotion-popover, .attachment-dropdown {
  .ant-popover-content, .ant-dropdown-menu {
    animation: popover-fade-in 0.2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }
}

@keyframes popover-fade-in {
  0% {
    opacity: 0;
    transform: translateY(-5px) scale(0.95);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* çŠ¶æ€åˆ‡æ¢æ—¶çš„å†…å®¹åŒºåŸŸåŠ¨ç”» */
.input-content-area {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  
  &.mode-transition {
    transform: translateZ(0); /* å¯ç”¨ç¡¬ä»¶åŠ é€Ÿ */
  }
}

/* Tailchatä¸»é¢˜é€‚é… */
.theme-dark {
  --color-text-secondary: rgba(255, 255, 255, 0.6);
}

.theme-light {
  --color-text-secondary: rgba(0, 0, 0, 0.6);
}

/* ğŸµ Telegram é£æ ¼ç´§å‡‘å½•éŸ³ç•Œé¢ */
.recording-state-compact {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 40px;
  padding: 0 8px;
  background: transparent;
}

.compact-recording-controls {
  display: flex;
  align-items: center;
  gap: 12px;
  height: 100%;
  max-width: 280px;
  width: 100%;
}

/* ç´§å‡‘æŒ‰é’®æ ·å¼ */
.stop-button-compact,
.send-button-compact {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  border: none;
  border-radius: 50%;
  background: rgba(0, 0, 0, 0.1);
  color: var(--color-text-primary);
  cursor: pointer;
  transition: all 0.15s ease;
  font-size: 16px;
  flex-shrink: 0;
  
  &:hover {
    background: rgba(0, 0, 0, 0.15);
    transform: scale(1.05);
  }
  
  &:active {
    transform: scale(0.95);
  }
  
  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none !important;
  }

  // ğŸš« æƒé™ç›¸å…³çŠ¶æ€æ ·å¼
  &.unsupported {
    opacity: 0.4;
    cursor: not-allowed;
    
    &:hover {
      background-color: #f5f5f5;
      color: #999;
    }
  }

  &.permission-denied {
    opacity: 0.6;
    cursor: help;
    color: #ff6b6b;
    
    &:hover {
      background-color: #fff5f5;
      color: #e63946;
    }
  }
}

.stop-button-compact {
  background: rgba(156, 163, 175, 0.15); /* ç°è‰²èƒŒæ™¯ï¼Œè¡¨ç¤ºåœæ­¢ */
  color: #6b7280; /* ç°è‰²å›¾æ ‡ */
  
  &:hover {
    background: rgba(156, 163, 175, 0.25);
    color: #4b5563; /* æ·±ç°è‰² */
  }
}

.send-button-compact {
  background: rgba(51, 144, 236, 0.1);
  color: #3390ec;
  
  &:hover {
    background: rgba(51, 144, 236, 0.2);
  }
}

/* ç´§å‡‘æ³¢å½¢åŒºåŸŸ */
.compact-waveform-area {
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 1;
  min-width: 0;
  height: 32px;
  padding: 4px 12px;
  background: rgba(0, 0, 0, 0.05);
  border-radius: 16px;
  overflow: hidden; /* é˜²æ­¢å­å…ƒç´ è¶…å‡ºåœ†è§’å®¹å™¨ */
  
  .compact-waveform-canvas {
    flex: 1 1 auto;
    min-width: 0; /* å…è®¸åœ¨æç«¯çª„å±ä¸‹æ”¶ç¼©ï¼Œé¿å…æ—¶é—´æ–‡æœ¬æº¢å‡º */
    max-width: 100% !important; /* è¦†ç›–å†…è”å®½åº¦ï¼Œè·Ÿéšå®¹å™¨ */
    width: 100% !important;     /* è¦†ç›–å†…è”å®½åº¦ï¼Œè·Ÿéšå®¹å™¨ */
    height: 20px;
    border-radius: 2px;
  }
  
  .compact-recording-time {
    font-family: var(--font-family-mono);
    font-size: 12px;
    font-weight: 500;
    color: var(--color-text-secondary);
    white-space: nowrap;
    flex-shrink: 0;
    min-width: 32px;
    max-width: 56px;    /* é™åˆ¶æœ€å¤§å®½åº¦ï¼Œé˜²æ­¢å¼‚å¸¸å­—ä½“ç¼©æ”¾æ—¶æº¢å‡º */
    overflow: hidden;
    text-overflow: clip;
    text-align: right;
  }
}

/* æš—è‰²ä¸»é¢˜é€‚é… */
.theme-dark {
  .compact-waveform-area {
    background: rgba(255, 255, 255, 0.1);
  }
  
  .stop-button-compact,
  .send-button-compact {
    background: rgba(255, 255, 255, 0.1);
    
    &:hover {
      background: rgba(255, 255, 255, 0.15);
    }
  }
  
  .stop-button-compact {
    background: rgba(156, 163, 175, 0.2); /* æš—è‰²ä¸»é¢˜ä¸‹çš„ç°è‰² */
    color: #9ca3af;
    
    &:hover {
      background: rgba(156, 163, 175, 0.3);
      color: #d1d5db;
    }
  }
  
  .send-button-compact {
    background: rgba(51, 144, 236, 0.2);
    
    &:hover {
      background: rgba(51, 144, 236, 0.3);
    }
  }
}

/* å½•éŸ³çŠ¶æ€åŠ¨ç”» */
.recording-state-compact {
  animation: compact-recording-fade-in 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

@keyframes compact-recording-fade-in {
  0% {
    opacity: 0;
    transform: translateY(-10px) scale(0.95);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 600px) {
  .compact-recording-controls {
    gap: 8px;
    max-width: 240px;
  }
  
  .compact-waveform-area {
    padding: 4px 8px;
    
    .compact-waveform-canvas {
      min-width: 0;          /* å…è®¸æ›´ç´§å‡‘çš„æ”¶ç¼© */
      max-width: 100% !important;
      width: 100% !important;
    }
    
    .compact-recording-time {
      font-size: 11px;
      min-width: 28px;
      max-width: 48px;
    }
  }
  
  .stop-button-compact,
  .send-button-compact {
    width: 28px;
    height: 28px;
    font-size: 14px;
  }
}
