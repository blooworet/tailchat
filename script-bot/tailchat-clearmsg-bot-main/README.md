# Tailchat 清理消息机器人

这是一个用于 Tailchat 平台的消息清理机器人，支持管理员清理所有消息和普通用户清理自己的消息。

## 功能特性

- 🤖 自动化消息清理
- 👑 管理员：清理所有平台消息
- 👤 普通用户：清理自己发布的消息
- 🔐 权限控制和二次确认
- 📊 使用管理后台 API
- ⚡ 快速批量删除

## 环境要求

- Node.js 16+
- Tailchat 服务器
- 管理员账号权限

## 安装使用

1. 克隆项目
2. 安装依赖：`npm install`
3. 配置环境变量（见下方）
4. 启动服务：`npm start`

## 环境变量配置

创建 `.env` 文件并配置以下变量：

```env
# Tailchat 服务器地址
host=https://your-tailchat-domain.com

# 机器人应用密钥
appSecret=your_app_secret

# 管理员用户名（多个用"|"分隔）
master=admin1|admin2

# 本服务监听端口
listen_port=3000

# 管理后台账号
ADMIN_USER=your_admin_username
ADMIN_PASS=your_admin_password
```

## 机器人回调地址设置

在 Tailchat 开放平台中设置机器人回调地址：
```
http://your-domain.com/bot/callback
```

## 使用方法

### 管理员使用
1. 在 Tailchat 中 @机器人
2. 机器人会自动开始清理**所有平台消息**
3. 等待清理完成

### 普通用户使用
1. 在 Tailchat 中 @机器人
2. 机器人会显示您的消息统计信息
3. 机器人询问是否删除您发布的所有消息
4. 回复确认信息来执行删除：
   - **确认**：`确认`、`yes`、`y`、`同意`、`是的`、`是`
   - **取消**：`取消`、`no`、`n`、`不`、`算了`
5. 确认后机器人会删除您的所有消息

## 功能说明

### 权限控制
- **管理员**：可以清理平台上的所有消息，无需确认
- **普通用户**：只能清理自己发布的消息，需要二次确认

### 二次确认机制
- 普通用户删除操作需要明确确认
- 确认请求会在5分钟后自动过期
- 支持多种确认和取消的表达方式

### 安全特性
- 用户只能删除自己的消息，无法删除他人消息
- 所有删除操作都有详细的日志记录
- 支持操作取消功能

## Docker 部署

```bash
# 构建镜像
docker build -t tailchat-clearmsg-bot .

# 启动服务
docker-compose up -d
```

## 注意事项

- ⚠️ 所有删除操作都不可撤销，请谨慎使用
- 🔒 权限严格控制，确保安全性
- 📝 所有操作都会记录详细日志
- ⏰ 确认请求有时效性（5分钟）
- 🚫 普通用户无法删除他人消息

## 示例对话流程

### 普通用户删除自己的消息
```
用户: @机器人
机器人: 🤖 您好 张三！

📊 检测到您在平台上共有 156 条消息

⚠️ 是否要删除您发布的所有消息？
⚠️ 此操作不可撤销！

💡 请回复以下任意内容来确认：
• "确认"、"yes"、"y"、"同意"、"是的"、"是"

💡 或回复以下内容来取消：
• "取消"、"no"、"n"、"不"、"算了"

⏰ 此确认请求将在5分钟后过期

用户: 确认
机器人: ⏳ 正在删除您的消息，请稍候...
机器人: ✅ 操作完成：删除成功: 共删除用户 张三 的 156 条消息
```

### 管理员删除所有消息
```
管理员: @机器人
机器人: ⏳ 开始清除所有消息，请稍候...
机器人: ✅ 操作完成：删除成功: 共删除 2847 条消息
```